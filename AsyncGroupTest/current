@Test
void testCreateGroupsAsync_FeignExceptionValidJson() throws Exception {
    // Arrange
    List<SecurityManagerEntitlementEntity> entities = List.of(new SecurityManagerEntitlementEntity());
    entities.get(0).setDisplayName("Group-<ClientID>");
    entities.get(0).setDescription("Desc-<ClientID>-<ClientName>");
    when(entitlementRepo.findAll()).thenReturn(entities);
    when(userService.getFreshAccessToken()).thenReturn("access123");

    String validJson = "{\"msg\":\"Some error occurred\",\"errorCode\":\"400\"}";
    FeignException feign = mock(FeignException.class);
    when(feign.contentUTF8()).thenReturn(validJson);

    when(saviyntClient.updateEntitlementsOnUser(any(), any())).thenThrow(feign);

    try (MockedStatic<StartAnywhereSecurityUtil> secUtil = mockStatic(StartAnywhereSecurityUtil.class)) {
        secUtil.when(() -> StartAnywhereSecurityUtil.unCleanIt(any())).thenReturn("{}");

        try (MockedStatic<RequestHeader> reqHeader = mockStatic(RequestHeader.class)) {
            RequestHeader header = new RequestHeader();
            header.setCorrelationId("corr123");
            reqHeader.when(() -> RequestHeader.parse(any())).thenReturn(header);

            when(trackRepo.findByCorrelationIdAndClientId(any(), any())).thenReturn(null);

            // Act + Assert
            assertDoesNotThrow(() ->
                service.createGroupsAsync("session", "{}", "client123", "ClientX")
            );
        }
    }
}
